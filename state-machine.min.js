!function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(n,e){var r="string"==typeof n.initial?{state:n.initial}:n.initial,i=n.terminal||n.final,o=e||n.target||{},a=n.events||[],u=n.callbacks||{},s={},c={},f=function(n){var e=Array.isArray(n.from)?n.from:n.from?[n.from]:[t.WILDCARD];s[n.name]=s[n.name]||{};for(var r=0;r<e.length;r++)c[e[r]]=c[e[r]]||[],c[e[r]].push(n.name),s[n.name][e[r]]=n.to||e[r];n.to&&(c[n.to]=c[n.to]||[])};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<a.length;l++)f(a[l]);for(var v in s)s.hasOwnProperty(v)&&(o[v]=t.buildEvent(v,s[v]));for(var v in u)u.hasOwnProperty(v)&&(o[v]=u[v]);return o.current="none",o.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},o.can=function(n){return!this.transition&&void 0!==s[n]&&(s[n].hasOwnProperty(this.current)||s[n].hasOwnProperty(t.WILDCARD))},o.cannot=function(t){return!this.can(t)},o.transitions=function(){return(c[this.current]||[]).concat(c[t.WILDCARD]||[])},o.isFinished=function(){return this.is(i)},o.tryTo=function(t){this.can(t)&&this[t]()},o.error=n.error||function(t,n,e,r,i,o,a){throw a||o},o.states=function(){return Object.keys(c).sort()},r&&!r.defer&&o[r.event](),o},doCallback:function(n,e,r,i,o,a){if(e)try{return e.apply(n,[r,i,o].concat(a))}catch(e){return n.error(r,i,o,a,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(n,e,r,i,o){return t.doCallback(n,n.onbeforeevent,e,r,i,o)},afterAnyEvent:function(n,e,r,i,o){return t.doCallback(n,n.onafterevent||n.onevent,e,r,i,o)},leaveAnyState:function(n,e,r,i,o){return t.doCallback(n,n.onleavestate,e,r,i,o)},enterAnyState:function(n,e,r,i,o){return t.doCallback(n,n.onenterstate||n.onstate,e,r,i,o)},changeState:function(n,e,r,i,o){return t.doCallback(n,n.onchangestate,e,r,i,o)},beforeThisEvent:function(n,e,r,i,o){return t.doCallback(n,n["onbefore"+e],e,r,i,o)},afterThisEvent:function(n,e,r,i,o){return t.doCallback(n,n["onafter"+e]||n["on"+e],e,r,i,o)},leaveThisState:function(n,e,r,i,o){return t.doCallback(n,n["onleave"+r],e,r,i,o)},enterThisState:function(n,e,r,i,o){return t.doCallback(n,n["onenter"+i]||n["on"+i],e,r,i,o)},beforeEvent:function(n,e,r,i,o){if(!1===t.beforeThisEvent(n,e,r,i,o)||!1===t.beforeAnyEvent(n,e,r,i,o))return!1},afterEvent:function(n,e,r,i,o){t.afterThisEvent(n,e,r,i,o),t.afterAnyEvent(n,e,r,i,o)},leaveState:function(n,e,r,i,o){var a=t.leaveThisState(n,e,r,i,o),u=t.leaveAnyState(n,e,r,i,o);return!1!==a&&!1!==u&&(t.ASYNC===a||t.ASYNC===u?t.ASYNC:void 0)},enterState:function(n,e,r,i,o){t.enterThisState(n,e,r,i,o),t.enterAnyState(n,e,r,i,o)},buildEvent:function(n,e){return function(){var r=this.current,i=e[r]||(e[t.WILDCARD]!=t.WILDCARD?e[t.WILDCARD]:r)||r,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(n,r,i,o,t.Error.PENDING_TRANSITION,"event "+n+" inappropriate because previous transition did not complete");if(this.cannot(n))return this.error(n,r,i,o,t.Error.INVALID_TRANSITION,"event "+n+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,n,r,i,o))return t.Result.CANCELLED;if(r===i)return t.afterEvent(this,n,r,i,o),t.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=i,t.enterState(a,n,r,i,o),t.changeState(a,n,r,i,o),t.afterEvent(a,n,r,i,o),t.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,t.afterEvent(a,n,r,i,o)};var u=t.leaveState(this,n,r,i,o);return!1===u?(this.transition=null,t.Result.CANCELLED):t.ASYNC===u?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.StateMachine=t):"function"==typeof define&&define.amd?define(function(n){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}();